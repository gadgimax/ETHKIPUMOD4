<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts\SimpleSwap.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> SimpleSwap.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">90.16% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>55/61</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">55% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>33/60</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>14/14</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">91.25% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>73/80</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">21×</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">19×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">359×</span>
<span class="cline-any cline-yes">359×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.27;
&nbsp;
import "@openzeppelin/contracts/token/ERC20/ERC20.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
&nbsp;
/// @title ETHKIPU MOD 3 - SimpleSwap 
/// @author Gaston Gorosito
/// @notice This contract allows users to add liquidity to a token pair and receive LP tokens.
/// @dev Simplified version inspired by Uniswap V2; LP tokens are minted as ERC20 (TokenL).
contract SimpleSwap is ERC20, Ownable {
&nbsp;
    /// @notice Struct for storing token reserves on the pool
    struct Reserve {
        uint reserve0;
        uint reserve1;
    }
    
    /// @notice Mapping to store reserves of each token pair
    /// @dev reserves[token0][token1] = struct with reserve amounts
    mapping(address =&gt; mapping(address =&gt; Reserve)) private reserves;
&nbsp;
    /// @notice Initializes the LP token and sets the contract owner
    /// @param initialOwner Address to be set as the initial owner
    constructor(address initialOwner)
        ERC20("TokenL", "TKL")
        Ownable(initialOwner)
    {}
&nbsp;
    /// @notice Sorts two token addresses to maintain canonical order (token0 &lt; token1)
    /// @dev Ensures consistent ordering for storage and lookup; prevents duplicate entries like (A,B) and (B,A)
    /// @param tokenA First token
    /// @param tokenB Second token
    /// @return token0 The lexicographically smaller address
    /// @return token1 The lexicographically larger address
    function sortTokens(address tokenA, address tokenB) private pure returns (address token0, address token1) {
        require(tokenA != tokenB, "Identical token addresses");
        require(tokenA != address(0) &amp;&amp; tokenB != address(0), "Zero address not allowed");
        (token0, token1) = tokenA &lt; tokenB ? (tokenA, tokenB) : <span class="missing-if-branch" title="else path not taken" >E</span>(tokenB, tokenA);
    }
&nbsp;
    /// @notice Returns the current reserves for a token pair
    /// @param tokenA First token of the pair
    /// @param tokenB Second token of the pair
    /// @return reserveA Reserve amount for tokenA
    /// @return reserveB Reserve amount for tokenB
    function getReserves(address tokenA, address tokenB) public view returns (uint reserveA, uint reserveB) {
        (reserveA, reserveB) = _getReserves(tokenA, tokenB);
    }
&nbsp;
    /// @notice Retrieve reserves in canonical order
    /// @dev Sorts token addresses once and returns the correct reserve values.
    /// @param tokenA One of the two tokens in the pair
    /// @param tokenB The other token in the pair
    /// @return reserveA Reserve corresponding to `tokenA`
    /// @return reserveB Reserve corresponding to `tokenB`
    function _getReserves(
        address tokenA,
        address tokenB
    ) internal view returns (uint reserveA, uint reserveB) {
        (address token0, address token1) = sortTokens(tokenA, tokenB);
        Reserve memory r = reserves[token0][token1];
        (reserveA, reserveB) = tokenA == token0
            ? (r.reserve0, r.reserve1)
            : <span class="missing-if-branch" title="else path not taken" >E</span>(r.reserve1, r.reserve0);
    }
&nbsp;
    /// @notice Adds liquidity to a given token pair
    /// @dev Transfers tokens from sender, calculates optimal amounts, and mints LP tokens
    /// @param tokenA First token to supply
    /// @param tokenB Second token to supply
    /// @param amountADesired Desired amount of tokenA
    /// @param amountBDesired Desired amount of tokenB
    /// @param amountAMin Minimum amount of tokenA accepted (slippage check)
    /// @param amountBMin Minimum amount of tokenB accepted (slippage check)
    /// @param to Address to receive LP tokens
    /// @param deadline Timestamp after which the tx is invalid
    /// @return amountA Actual amount of tokenA used
    /// @return amountB Actual amount of tokenB used
    /// @return liquidity LP tokens minted
    function addLiquidity(
        address tokenA,
        address tokenB,
        uint amountADesired,
        uint amountBDesired,
        uint amountAMin,
        uint amountBMin,
        address to,
        uint deadline
    ) external returns (uint amountA, uint amountB, uint liquidity) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(block.timestamp &lt;= deadline, "Deadline expired");
        (uint reserveA, uint reserveB) = _getReserves(tokenA, tokenB);
    
        (amountA, amountB) = _computeLiquidityAmounts(
            reserveA,
            reserveB,
            amountADesired,
            amountBDesired,
            amountAMin,
            amountBMin
        );
&nbsp;
        // Transfer tokens from sender to this contract
        IERC20(tokenA).transferFrom(msg.sender, address(this), amountA);
        IERC20(tokenB).transferFrom(msg.sender, address(this), amountB);
&nbsp;
        // Mint LP tokens to provider
        liquidity = calculateLiquidity(amountA, amountB, reserveA, reserveB);
        _mint(to, liquidity);
&nbsp;
        // Update pool reserves
        updateReserves(tokenA, tokenB, reserveA + amountA, reserveB + amountB);
&nbsp;
    }
&nbsp;
    /// @dev Calculates the actual token amounts to be used for maintaining reserve ratio
    /// @param reserveA Current reserve of tokenA
    /// @param reserveB Current reserve of tokenB
    /// @param amountADesired Desired tokenA to contribute
    /// @param amountBDesired Desired tokenB to contribute
    /// @param amountAMin Minimum tokenA accepted
    /// @param amountBMin Minimum tokenB accepted
    /// @return amountA Final tokenA to be used
    /// @return amountB Final tokenB to be used
    function _computeLiquidityAmounts(
        uint reserveA,
        uint reserveB,
        uint amountADesired,
        uint amountBDesired,
        uint amountAMin,
        uint amountBMin
    ) private pure returns (uint amountA, uint amountB) {
        // If this is the first liquidity provider (no reserves), accept all desired amounts
        // This will define the initial tokens ratio
        if (reserveA == 0 &amp;&amp; reserveB == 0) {
            return (amountADesired, amountBDesired);
        }
&nbsp;
        // Calculate how much of tokenB is needed to match the desired amountA while keeping the ratio
        // Derived from: amountBOptimal / amountADesired = reserveB / reserveA to maintain pool ratio
        uint amountBOptimal = (amountADesired * reserveB) / reserveA;
&nbsp;
        // If user provided enough (or more) tokenB to match the desired tokenA, use all of A (amountADesired)
        <span class="missing-if-branch" title="else path not taken" >E</span>if (amountBOptimal &lt;= amountBDesired) {
            // Ensure tokenB provided is still above minimum required
            <span class="missing-if-branch" title="else path not taken" >E</span>require(amountBOptimal &gt;= amountBMin, "Insufficient amountB");
            return (amountADesired, amountBOptimal);
        }
&nbsp;
        // Otherwise, calculate how much of tokenA is needed to match the provided tokenB
<span class="cstat-no" title="statement not covered" >        uint amountAOptimal = (amountBDesired * reserveA) / reserveB;</span>
&nbsp;
        // Ensure tokenA provided is still above minimum required
<span class="cstat-no" title="statement not covered" >        require(amountAOptimal &gt;= amountAMin, "Insufficient amountA")</span>;
<span class="cstat-no" title="statement not covered" >        return (amountAOptimal, amountBDesired);</span>
    }
&nbsp;
    /// @notice Updates the reserves for a token pair
    /// @dev Internal function to update bidirectional mapping using canonical order
    /// @param tokenA First token
    /// @param tokenB Second token
    /// @param newReserveA New amount of tokenA in the pool
    /// @param newReserveB New amount of tokenB in the pool
    function updateReserves(address tokenA, address tokenB, uint newReserveA, uint newReserveB) private {
        (address token0, address token1) = sortTokens(tokenA, tokenB);
        Reserve storage r = reserves[token0][token1];
&nbsp;
        // Check if values differ to save gas from writting in storage
        <span class="missing-if-branch" title="else path not taken" >E</span>if (tokenA == token0) {
            <span class="missing-if-branch" title="else path not taken" >E</span>if (r.reserve0 != newReserveA) r.reserve0 = newReserveA;
            <span class="missing-if-branch" title="else path not taken" >E</span>if (r.reserve1 != newReserveB) r.reserve1 = newReserveB;
        } else {
<span class="cstat-no" title="statement not covered" >            if (r.reserve0 != newReserveB) r.reserve0 = newReserveB;</span>
<span class="cstat-no" title="statement not covered" >            if (r.reserve1 != newReserveA) r.reserve1 = newReserveA;</span>
        }
    }
&nbsp;
    /// @notice Calculates the amount of LP tokens to mint based on current reserves
    /// @dev Follows Uniswap V2 logic: sqrt(amountA * amountB) for first provider, else proportional to existing supply
    /// @param amountA Amount of tokenA being added
    /// @param amountB Amount of tokenB being added
    /// @param reserveA Current reserve of tokenA
    /// @param reserveB Current reserve of tokenB
    /// @return liquidity Amount of LP tokens to mint
    function calculateLiquidity(
        uint amountA,
        uint amountB,
        uint reserveA,
        uint reserveB
    ) private view returns (uint liquidity) {
        uint _totalSupply = totalSupply();
&nbsp;
        // Based on: https://app.uniswap.org/whitepaper.pdf
        // 'Initially mints shares equal to the geometric mean of the amounts deposited'
        if (_totalSupply == 0) {
            liquidity = _sqrt(amountA * amountB);
        } else {
            // Check if dividing by zero
            <span class="missing-if-branch" title="else path not taken" >E</span>require(reserveA &gt; 0 &amp;&amp; reserveB &gt; 0, "Invalid reserves");
            uint liquidityA = (amountA * _totalSupply) / reserveA;
            uint liquidityB = (amountB * _totalSupply) / reserveB;
            // Get the MIN liquidity value
            liquidity = liquidityA &lt; liquidityB ? <span class="missing-if-branch" title="if path not taken" >I</span>liquidityA : liquidityB;
        }
&nbsp;
        <span class="missing-if-branch" title="else path not taken" >E</span>require(liquidity &gt; 0, "Insufficient liquidity minted");
    }
&nbsp;
    /// @notice Removes liquidity from the pool, burns liquidity tokens, and returns original tokens
    /// @param tokenA First token to supply
    /// @param tokenB Second token to supply
    /// @param liquidity LP tokens burned
    /// @param amountAMin Minimum amount of tokenA accepted (slippage check)
    /// @param amountBMin Minimum amount of tokenB accepted (slippage check)
    /// @param to Address of receiving user
    /// @param deadline Timestamp after which the tx is invalid
    /// @return amountA for returned token A amount
    /// @return amountB for returned token B amount
    function removeLiquidity(
        address tokenA, 
        address tokenB, 
        uint liquidity, 
        uint amountAMin, 
        uint amountBMin, 
        address to, 
        uint deadline
    ) external returns (uint amountA, uint amountB) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(block.timestamp &lt;= deadline, "Deadline expired");
        uint _totalSupply = totalSupply();
&nbsp;
        (uint reserveA, uint reserveB) = _getReserves(tokenA, tokenB);
        // Calculate amount of A &amp; B tokens based on provided liquidity
        amountA = liquidity * reserveA / _totalSupply;
        amountB = liquidity * reserveB / _totalSupply;
&nbsp;
        // Check slippage
        <span class="missing-if-branch" title="else path not taken" >E</span>require(amountA &gt;= amountAMin, "Min A amount not met");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(amountB &gt;= amountBMin, "Min B amount not met");
&nbsp;
        // Burn liquidity tokens from user's balance
        _burn(msg.sender, liquidity);
&nbsp;
        // Transfer original tokens to the 'to' address
        IERC20(tokenA).transfer(to, amountA);
        IERC20(tokenB).transfer(to, amountB);
&nbsp;
        // Update reserves accordingly
        updateReserves(tokenA, tokenB, reserveA - amountA, reserveB - amountB);
    }
&nbsp;
    /// @notice Calculates the price of token A in terms of token B
    /// @param tokenA Address of the first token
    /// @param tokenB Address of the second token
    /// @return price token A value expressed in terms of token B
    function getPrice(address tokenA, address tokenB) external view returns (uint price) {
        (uint reserveA, uint reserveB) = _getReserves(tokenA, tokenB);
        <span class="missing-if-branch" title="else path not taken" >E</span>require(reserveA &gt; 0, "No liquidity for tokenA");
&nbsp;
        // Price of token A in terms of token B (i.e., how many B per 1 A)
        price = reserveB * 1e18 / reserveA;
    }
&nbsp;
    /// @notice Calculates how many tokens will be received for a given input amount
    /// @param amountIn Amount of input token
    /// @param reserveIn Reserve of input token in the pool
    /// @param reserveOut Reserve of output token in the pool
    /// @return amountOut Calculated amount of output token to receive
    function getAmountOut(
        uint amountIn,
        uint reserveIn,
        uint reserveOut
    ) external pure returns (uint amountOut) {
        amountOut = _getAmountOut(amountIn, reserveIn, reserveOut);
    }
    
    /// @notice getAmountOut internal wrapper to reduce gas for internal calls
    function _getAmountOut(uint amountIn, uint reserveIn, uint reserveOut) internal pure returns (uint amountOut) {
        require(amountIn &gt; 0, "Amount must be &gt; 0");
        require(reserveIn &gt; 0 &amp;&amp; reserveOut &gt; 0, "Invalid reserves");
&nbsp;
        // Formula: amountOut = (amountIn * reserveB) / (reserveA + amountIn)
        amountOut = (amountIn * reserveOut) / (reserveIn + amountIn);
    }
&nbsp;
    /// @notice Swap an exact amount of tokenIn for as many tokenOut as possible
    /// @param amountIn Exact amount of input tokens supplied by the caller
    /// @param amountOutMin Minimum acceptable output tokens (slippage protection)
    /// @param path [tokenIn, tokenOut] only length-2 is supported in this version
    /// @param to Recipient of tokenOut
    /// @param deadline Timestamp after which the tx is invalid
    /// @return amounts [amountIn, amountOut] for convenience
    function swapExactTokensForTokens(
        uint amountIn,
        uint amountOutMin,
        address[] calldata path,
        address to,
        uint deadline
    ) external returns (uint[] memory amounts) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(block.timestamp &lt;= deadline, "Deadline expired");
        require(path.length == 2, "Only 1-step swaps supported");
&nbsp;
        address tokenIn  = path[0];
        address tokenOut = path[1];
&nbsp;
        // Get token reserves
        (uint reserveIn, uint reserveOut) = _getReserves(tokenIn, tokenOut);
        <span class="missing-if-branch" title="else path not taken" >E</span>require(reserveIn &gt; 0 &amp;&amp; reserveOut &gt; 0, "No liquidity");
&nbsp;
        // Calculate output
        uint amountOut = _getAmountOut(amountIn, reserveIn, reserveOut);
        <span class="missing-if-branch" title="else path not taken" >E</span>require(amountOut &gt;= amountOutMin, "Insufficient output amount");
&nbsp;
        // Transfer tokens from user to pool
        IERC20(tokenIn).transferFrom(msg.sender, address(this), amountIn);
&nbsp;
        // Transfer tokens from pool to user
        IERC20(tokenOut).transfer(to, amountOut);
&nbsp;
        // Update reserves
        updateReserves(tokenIn, tokenOut, reserveIn + amountIn, reserveOut - amountOut);
&nbsp;
        amounts = new uint[](2) ;
        amounts[0] = amountIn;
        amounts[1] = amountOut;
        return amounts;
    }
&nbsp;
    /// @notice Computes the integer square root of a given number
    /// @dev Uses the Babylonian method as implemented in Uniswap V2 (see: https://github.com/Uniswap/v2-core/blob/v1.0.1/contracts/libraries/Math.sol)
    /// @param y The input value
    /// @return z The largest integer such that z*z &lt;= y
    function _sqrt(uint y) private pure returns (uint z) {
        <span class="missing-if-branch" title="else path not taken" >E</span>if (y &gt; 3) {
            z = y;
            uint x = y / 2 + 1;
            while (x &lt; z) {
                z = x;
                x = (y / x + x) / 2;
            }
        } else <span class="cstat-no" title="statement not covered" >if (y != 0) {</span>
            z = 1;
        } else {
            z = 0; // In case y == 0
        }
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Fri Jul 04 2025 05:04:53 GMT-0300 (Argentina Standard Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
